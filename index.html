<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <div id="data"></div>
    <div id="status"></div> <!-- Phần này để hiển thị trạng thái kết nối WebSocket -->
    <div id="count"></div> <!-- Phần này để hiển thị số lần nhận dữ liệu từ BE -->

    <script>
        let socket;
        let count = 0;  // Biến đếm số lần nhận dữ liệu

        // Function to connect WebSocket
        function connectWebSocket() {
            socket = new WebSocket("ws://127.0.0.1:8000/ws");

            // Thay đổi trạng thái kết nối WebSocket
            socket.onopen = () => {
                console.log("Connected to WebSocket!");
                document.getElementById('status').innerText = "WebSocket Connected!";
                document.getElementById('status').style.color = 'green';
            };

            socket.onmessage = (event) => {
                // Hiển thị dữ liệu nhận được
                document.getElementById('data').innerText = "Confidence: " + event.data;

                // Tăng biến count mỗi khi nhận được dữ liệu
                count++;
                document.getElementById('count').innerText = "Data received: " + count + " times";  // Hiển thị số lần nhận dữ liệu
            };

            socket.onerror = (error) => {
                console.log("WebSocket Error: ", error);
                document.getElementById('status').innerText = "WebSocket Error!";
                document.getElementById('status').style.color = 'red';
            };

            socket.onclose = (event) => {
                console.log("WebSocket closed. Reconnecting...");
                document.getElementById('status').innerText = "WebSocket Disconnected. Reconnecting...";
                document.getElementById('status').style.color = 'orange';
                // Tự động kết nối lại sau 1 giây nếu WebSocket bị ngắt
                setTimeout(connectWebSocket, 1000);
            };
        }

        // Kiểm tra trạng thái của WebSocket
        function checkSocketStatus() {
            if (socket) {
                if (socket.readyState === WebSocket.CONNECTING) {
                    return "Connecting...";
                } else if (socket.readyState === WebSocket.OPEN) {
                    return "Connected";
                } else if (socket.readyState === WebSocket.CLOSING) {
                    return "Closing...";
                } else if (socket.readyState === WebSocket.CLOSED) {
                    return "Disconnected";
                }
            } else {
                return "No WebSocket connection";
            }
        }

        // Function to update status text every second
        setInterval(function() {
            const statusText = checkSocketStatus();
            document.getElementById('status').innerText = "WebSocket Status: " + statusText;
        }, 1000);  // Cập nhật mỗi 1 giây

        // Khởi tạo kết nối WebSocket
        connectWebSocket();
    </script>
</body>
</html>
